<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>FAT32 Image Defragmenter: dev/#gpl/defrag/src/analyze.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FAT32 Image Defragmenter&#160;<span id="projectnumber">0.1b</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('analyze_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dev/#gpl/defrag/src/analyze.c File Reference</div>  </div>
</div>
<div class="contents">

<p>Module for disk fragmentation analysis.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#a59146c8f2220dc576f2afcf93b91838a">an_addFile</a> (unsigned long startCluster, unsigned long entCluster, unsigned short ind)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#a21b82d9878dfdae0025f787743151e1e">an_freeTable</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#a8f31185f136821a2e48d66ee1f83f6dd">an_getFileFragmentation</a> (unsigned long startCluster, unsigned long aTIndex)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#ace270000fbc5c358e0b91391130c0e24">an_scanDisk</a> (unsigned long startCluster)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#a91da66b80cc4426f95ea595728397969">an_analyze</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">aTableItem *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#aae722730d25f55c4c19a95a1f3c29450">aTable</a> = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#a93fda6a42cb7e241f75cef97bb823f75">tableCount</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#a5f32380ce23ee66b8da8eadf3886e00e">diskFragmentation</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#ab96d26e22637f4e24805347711d241cc">usedClusters</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="analyze_8c.html#a19b180e99a5e9ae308eb4d5a315fb0bd">entryCount</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"></div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a59146c8f2220dc576f2afcf93b91838a"></a><!-- doxytag: member="analyze.c::an_addFile" ref="a59146c8f2220dc576f2afcf93b91838a" args="(unsigned long startCluster, unsigned long entCluster, unsigned short ind)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void an_addFile </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>startCluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>entCluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>ind</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Filling the aTable table woks in recursive way, the table is implemented as dynamic array of max 10000 items (i.e. there can exist maximum 10000 files and directories together on disk). More appropriate implementation would be using linked list, but for experiment purposes the dynamic array is enough. This function adds new item into the aTable, however it fills only some informations in the item </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">startCluster</td><td>starting cluster of the item </td></tr>
    <tr><td class="paramname">entCluster</td><td>directory cluster that links to the item </td></tr>
    <tr><td class="paramname">ind</td><td>index of the item in directory cluster </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a21b82d9878dfdae0025f787743151e1e"></a><!-- doxytag: member="analyze.c::an_freeTable" ref="a21b82d9878dfdae0025f787743151e1e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void an_freeTable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The function frees up memory used for aTable </p>

</div>
</div>
<a class="anchor" id="a8f31185f136821a2e48d66ee1f83f6dd"></a><!-- doxytag: member="analyze.c::an_getFileFragmentation" ref="a8f31185f136821a2e48d66ee1f83f6dd" args="(unsigned long startCluster, unsigned long aTIndex)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float an_getFileFragmentation </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>startCluster</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>aTIndex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The function determines percentage fragmentation of single directory item (file/directory). It is part of the deep disk analysis.</p>
<p>For given starting cluster it traverses all the chain of clusters and determines if clusters are going one after another, i.e. that if the difference of next and actual cluster number is 1. In a case that not, it increments number of fragmented clusters. Within the traversion of the chain there is stored number of all clusters that were traversed. After loop is finished, this variable contains number ofall clusters of the file or directory and it is stored. into aTable. Percentual fragmentation is computed as: </p>
<div class="fragment"><pre class="fragment">   (num. of frag.cluster of the item) / (num. of all used clusters of the item) * 100
</pre></div> <dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">startCluster</td><td>Starting cluster of the item </td></tr>
    <tr><td class="paramname">aTIndex</td><td>index in aTable - into the table is written number of clusters of the directory item </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>item fragmentation in percentage </dd></dl>

</div>
</div>
<a class="anchor" id="ace270000fbc5c358e0b91391130c0e24"></a><!-- doxytag: member="analyze.c::an_scanDisk" ref="ace270000fbc5c358e0b91391130c0e24" args="(unsigned long startCluster)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void an_scanDisk </td>
          <td>(</td>
          <td class="paramtype">unsigned long&#160;</td>
          <td class="paramname"><em>startCluster</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>This function recursively traverses all directory structure. It is part of the first phase of disk analysis (the basic one). During the traversation it stores into aTable important information about directory item, such as starting cluster, number of directory cluster that contains link for given item and index in the directory cluster. Besides it calls for each item the an_getFileFragmentation function (to get its percentage fragmentation). This fragmentation is added to global variable called diskFragmentation. Be careful! The FAT table has to be OK; in the other case there can be circular referrences (or cross references)! </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">startCluster</td><td>number of root cluster (from where should the traversation start) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a91da66b80cc4426f95ea595728397969"></a><!-- doxytag: member="analyze.c::an_analyze" ref="a91da66b80cc4426f95ea595728397969" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int an_analyze </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Main function for disk analysis; before it calls an_scanDisk function, it performs some preparation operations, such as it gets number of items in directory and adds first value into aTable - the root cluster, and computes its fragmentation. After finishing recursive traversation of directory structure it computes global percentage disk fragmentation by dividing diskFragmentation variable by number of items in aTable. </p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aae722730d25f55c4c19a95a1f3c29450"></a><!-- doxytag: member="analyze.c::aTable" ref="aae722730d25f55c4c19a95a1f3c29450" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">aTableItem* <a class="el" href="analyze_8c.html#aae722730d25f55c4c19a95a1f3c29450">aTable</a> = NULL</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Table with important informations about each item in all directory structure. The items contain: starting cluster, the number of directory cluster, the number of the item in the directory cluster, number of clusters (this value is filled up in deep analysis). Defragmentation works based on values within this table. </p>

</div>
</div>
<a class="anchor" id="a93fda6a42cb7e241f75cef97bb823f75"></a><!-- doxytag: member="analyze.c::tableCount" ref="a93fda6a42cb7e241f75cef97bb823f75" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="analyze_8c.html#a93fda6a42cb7e241f75cef97bb823f75">tableCount</a> = 0</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of values in the table is equal to number of all files and directories that have allocated almost 1 cluster </p>

</div>
</div>
<a class="anchor" id="a5f32380ce23ee66b8da8eadf3886e00e"></a><!-- doxytag: member="analyze.c::diskFragmentation" ref="a5f32380ce23ee66b8da8eadf3886e00e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="analyze_8c.html#a5f32380ce23ee66b8da8eadf3886e00e">diskFragmentation</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Percentual disk fragmentation </p>

</div>
</div>
<a class="anchor" id="ab96d26e22637f4e24805347711d241cc"></a><!-- doxytag: member="analyze.c::usedClusters" ref="ab96d26e22637f4e24805347711d241cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long <a class="el" href="analyze_8c.html#ab96d26e22637f4e24805347711d241cc">usedClusters</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of used clusters </p>

</div>
</div>
<a class="anchor" id="a19b180e99a5e9ae308eb4d5a315fb0bd"></a><!-- doxytag: member="analyze.c::entryCount" ref="a19b180e99a5e9ae308eb4d5a315fb0bd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned short <a class="el" href="analyze_8c.html#a19b180e99a5e9ae308eb4d5a315fb0bd">entryCount</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Number of items in single directory (variable value according to cluster size) </p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="analyze_8c.html">analyze.c</a>      </li>
      <li class="footer">Generated on Tue Apr 26 2011 11:33:24 for FAT32 Image Defragmenter by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>

</body>
</html>
